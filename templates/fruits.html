{% extends "base.html" %}

{% block title %}Fruits - Fruit Battlegrounds Wiki{% endblock %}

{% block content %}
<!-- New Loading Animation -->
<div id="loading-overlay" class="loading-animation-container">
    <!-- Wrapper for logo and loader -->
    <div class="loading-content-wrapper">
        <!-- Added Game Logo Back -->
        <img src="{{ url_for('static', filename='images/game_logo.png') }}" alt="Fruit Battlegrounds Logo" class="loading-logo-img">

        <!-- Wave Loader -->
        <div class="loader"></div>

        <!-- Added Text Loader Below -->
        <div class="text-loader-card">
          <div class="text-loader">
        <p>Loading</p>
        <div class="words">
            <span class="word">Fruits</span>
            <span class="word">Rarities</span>
              <span class="word">Abilities</span>
              <span class="word">Skills</span>
              <span class="word">Fruits</span> <!-- Repeat for loop -->
        </div>
    </div>
        </div>
    </div>
</div>

<div class="fruits-page" data-aos="fade-in">
    <div class="header-accent"></div>
    <div class="section-header" data-aos="fade-down">
        <h1 class="section-title display-4 mb-3">Fruits</h1>
        <p class="lead mb-4 text-muted">
            Fruits are the main combat system in Fruit Battlegrounds. They can be obtained via spinning or from boss drops.
            Each fruit grants unique abilities and skills that can be used in combat.
        </p>
    </div>

    <div class="row mb-5">
        <div class="col-md-6" data-aos="fade-right" data-aos-delay="100">
            <div class="card shadow-sm h-100 border-0">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-wrapper me-3">
                            <i class="fas fa-dice text-primary"></i>
                        </div>
                        <h5 class="card-title mb-0">Fruit Spinner</h5>
                    </div>
                    <p class="card-text">
                        You can spin for fruits using Gems. Each spin costs 50 Gems.
                        The Pity System helps increase your chances of getting rarer fruits after multiple spins.
                    </p>
                    <a href="#pity-system" class="btn btn-primary">Learn About Pity System</a>
                </div>
            </div>
        </div>
        <div class="col-md-6" data-aos="fade-left" data-aos-delay="100">
            <div class="card shadow-sm h-100 border-0">
                <div class="card-body d-flex flex-column">
                    <!-- Header with Icon and Title -->
                    <div class="d-flex align-items-center mb-3">
                        <div class="icon-wrapper me-3" style="background-color: rgba(var(--bs-success-rgb), 0.1);">
                            <i class="fas fa-search text-success"></i>
                </div>
                        <h5 class="card-title mb-0">Search Fruits</h5>
                        </div>
                    <!-- Description Text -->
                    <p class="card-text text-muted mb-3">Quickly find fruits by typing their name below.</p>

                    <!-- Animated Search Input -->
                    <div class="mt-auto"> <!-- Push search to bottom if needed, or remove mt-auto for normal flow -->
                        <label for="fruit-search-input" class="label">
                          <span class="label-title">Enter Fruit Name</span> <!-- Changed label text slightly -->
                          <input id="fruit-search-input" class="input" name="text" placeholder="E.g., Leopard, Magma..." type="text">
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="fruit-container position-relative">
        <!-- Loading animation removed -->

        <div class="fruit-grid" id="fruit-list">
        {% for fruit in fruits %}
            <div class="fruit-card" data-fruit="{{ fruit.name }}" data-aos="zoom-in-up" data-aos-delay="{{ (loop.index0 % 4) * 50 }}">
                <div class="card h-100 border-0 shadow-sm fruit-card-inner bg-rarity-{{ fruit.rarity.lower() }}">
                    {% if fruit.image %}
                    <div class="fruit-image-container">
                <img src="{{ url_for('static', filename='images/fruits/' + fruit.image) }}" alt="{{ fruit.name }}" class="card-img-top fruit-img" loading="lazy">
                    </div>
                    {% else %}
                    <div class="bg-secondary text-white text-center py-5 card-img-top d-flex align-items-center justify-content-center">No Image</div>
                    {% endif %}
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ fruit.name }}</h5>
                    <span class="badge-effect badge-effect-{{ fruit.rarity.lower() }}">
                        {% if fruit.rarity.lower() == 'mythical' %}
                        <canvas class="mythical-lightning-canvas"></canvas>
                        {% elif fruit.rarity.lower() == 'legendary' %}
                        <canvas class="legendary-shine-canvas"></canvas>
                        {% endif %}
                        <span class="badge-text">{{ fruit.rarity }}</span>
                    </span>
                    {% if fruit.type %}
                    <span class="badge type-badge type-{{ fruit.type.lower() }}">{{ fruit.type }}</span>
                    {% endif %}
                        <p class="card-text">{{ fruit.description | truncate(80) }}</p>
                    <p class="text-muted small">Drop Rate: {{ fruit.drop_rate }}%</p>
                    <div class="mt-auto">
                        <a href="{{ url_for('fruit_detail', fruit_id=fruit.id) }}" class="btn btn-sm btn-primary w-100">View Details</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        </div>
        <!-- Add the 'no results' message container here -->
        <div id="no-search-results" class="no-results" style="display: none;">
            <div class="no-results-content">
                <i class="fas fa-search-minus"></i>
                <p>No fruits found matching your search</p>
            </div>
        </div>
    </div>

    <div class="mt-5 pt-3" id="fruit-types" data-aos="fade-up">
        <div class="section-header mb-4">
            <h2 class="section-title">Fruit Types</h2>
            <div class="section-subtitle">Understanding Devil Fruit Classifications</div>
        </div>
        <div class="card border-0 shadow mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <div class="fruit-type-card">
                            <div class="fruit-type-header type-logia">
                                <h4>Logia</h4>
                            </div>
                            <div class="fruit-type-body">
                                <p>
                                    Logia-type fruits are considered the most powerful. They allow the user to transform into, create, and control a natural element or phenomenon. Users can become intangible and nearly invulnerable to physical attacks.
                                </p>
                                <p class="mt-2"><strong>Examples:</strong> Lightning, Ice, Magma, Light, Darkness, Snow</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="fruit-type-card">
                            <div class="fruit-type-header type-paramecia">
                                <h4>Paramecia</h4>
                            </div>
                            <div class="fruit-type-body">
                                <p>
                                    Paramecia-type fruits grant users superhuman abilities that affect their body, manipulate the environment, or produce substances. These fruits have the greatest variety of powers and applications.
                                </p>
                                <p class="mt-2"><strong>Examples:</strong> Quake, Rubber, Dough, Barrier, String, Love</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="fruit-type-card">
                            <div class="fruit-type-header type-zoan">
                                <h4>Zoan</h4>
                            </div>
                            <div class="fruit-type-body">
                                <p>
                                    Zoan-type fruits allow users to transform into other species and inter-species hybrid forms. They typically enhance physical abilities like strength, speed, and endurance.
                                </p>
                                <p class="mt-2"><strong>Examples:</strong> Phoenix, Dragon, Leopard, Falcon, Okuchi, Nika</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-5 pt-3" id="pity-system" data-aos="fade-up">
        <div class="section-header mb-4">
        <h2 class="section-title">Pity System</h2>
            <div class="section-subtitle">Increase Your Chances of Rare Fruits</div>
        </div>
        <div class="card border-0 shadow">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                <p>
                    The Pity System helps players obtain rarer fruits by increasing the chances of getting them after multiple unsuccessful spins.
                    There are three Pity categories: Rare, Epic, and Legendary.
                </p>

                        <ul class="pity-list">
                            <li>
                                <span class="pity-tag pity-tag-rare">Rare Pity</span>
                                <span>Increases chances for Rare fruits</span>
                            </li>
                            <li>
                                <span class="pity-tag pity-tag-epic">Epic Pity</span>
                                <span>Increases chances for Epic fruits</span>
                            </li>
                            <li>
                                <span class="pity-tag pity-tag-legendary">Legendary Pity</span>
                                <span>Increases chances for Legendary and Mythical fruits</span>
                            </li>
                </ul>
                    </div>
                    <div class="col-md-6">
                <p>
                            When each pity reaches its threshold, you are automatically <strong>GUARANTEED</strong> a fruit from that rarity.
                    However, there is a pity timer that resets 5 hours after you start spinning.
                </p>

                        <div class="alert alert-info custom-alert">
                            <div class="alert-icon-container">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="alert-content">
                                <strong>Note:</strong> The pity saves when you leave the server so do not worry if you unfortunately disconnect from the game, your pity is safe!
                            </div>
                        </div>

                <p>
                    Fruits with a rarity of Legendary or higher will be guaranteed to be a fruit you do not have in your fruit storage.
                </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-5 pt-3" id="update-20" data-aos="fade-up">
        <div class="section-header mb-4">
        <h2 class="section-title">Update 20 - New Fruits & Rebirth System</h2>
            <div class="section-subtitle">Latest Major Game Update</div>
        </div>
        <div class="card border-0 shadow mb-4">
            <div class="card-header bg-primary text-white py-3">
                <h5 class="mb-0"><i class="fas fa-star me-2"></i>New Fruits in Update 20</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-3">
                            <span class="badge-effect badge-effect-mythical me-2">
                                <canvas class="mythical-lightning-canvas"></canvas>
                                <span class="badge-text">Mythical</span>
                            </span>
                            <h5 class="mb-0">LeopardV2</h5>
                        </div>
                        <p>
                            The upgraded version of Leopard fruit with enhanced abilities. Leopard has been moved from Mythical to Legendary rarity due to LeopardV2's introduction. With this fruit, you can transform into a powerful leopard-human hybrid with devastating attacks.
                        </p>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-3">
                            <span class="badge-effect badge-effect-epic me-2">
                                <span class="badge-text">Epic</span>
                            </span>
                            <h5 class="mb-0">Snow</h5>
                        </div>
                        <p>
                            "Smother the battlefield in white cold snow, freezing or defending anyone in its path." Snow is a Logia-type fruit with a 0.92% drop rate. By reaching level 100 with this fruit, you'll earn the title "Winter Knight".
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="rebirth-system-card" data-aos="fade-up" data-aos-delay="100">
            <div class="rebirth-header">
                <div class="d-flex align-items-center">
                    <i class="fas fa-sync-alt me-2"></i>
                <h5 class="mb-0">Rebirth System</h5>
            </div>
            </div>
            <div class="rebirth-content p-4">
                <p>
                    The new Rebirth system allows you to exchange a maxed-level fruit and gems for another fruit of the next rarity tier. Talk to Rayleigh NPC located in the Live Floor of Onigashima (opposite side of the dummies) to access this feature.
                </p>

                <div class="alert alert-info custom-alert mb-4 mt-3">
                    <div class="alert-icon-container">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="alert-content">
                        <strong>Note:</strong> V2 fruits are not included in the Rebirth pool!
                    </div>
                </div>

                <h6 class="mb-3">Rebirth Requirements:</h6>
                <div class="table-responsive">
                    <table class="rebirth-table">
                        <thead>
                            <tr>
                                <th>Rarity Progression</th>
                                <th>Gem Cost</th>
                                <th>Other Requirements</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <span class="badge-effect badge-effect-common">
                                            <span class="badge-text">Common</span>
                                        </span>
                                        <span class="progression-arrow">→</span>
                                        <span class="badge-effect badge-effect-uncommon">
                                            <span class="badge-text">Uncommon</span>
                                        </span>
                                    </div>
                                </td>
                                <td>250 Gems</td>
                                <td rowspan="5">Fruit must be at max level (300)</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <span class="badge-effect badge-effect-uncommon">
                                            <span class="badge-text">Uncommon</span>
                                        </span>
                                        <span class="progression-arrow">→</span>
                                        <span class="badge-effect badge-effect-rare">
                                            <span class="badge-text">Rare</span>
                                        </span>
                                    </div>
                                </td>
                                <td>500 Gems</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <span class="badge-effect badge-effect-rare">
                                            <span class="badge-text">Rare</span>
                                        </span>
                                        <span class="progression-arrow">→</span>
                                        <span class="badge-effect badge-effect-epic">
                                            <span class="badge-text">Epic</span>
                                        </span>
                                    </div>
                                </td>
                                <td>2,500 Gems</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <span class="badge-effect badge-effect-epic">
                                            <span class="badge-text">Epic</span>
                                        </span>
                                        <span class="progression-arrow">→</span>
                                        <span class="badge-effect badge-effect-legendary">
                                            <canvas class="legendary-shine-canvas"></canvas>
                                            <span class="badge-text">Legendary</span>
                                        </span>
                                    </div>
                                </td>
                                <td>10,000 Gems</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <span class="badge-effect badge-effect-legendary">
                                            <canvas class="legendary-shine-canvas"></canvas>
                                            <span class="badge-text">Legendary</span>
                                        </span>
                                        <span class="progression-arrow">→</span>
                                        <span class="badge-effect badge-effect-mythical">
                                            <canvas class="mythical-lightning-canvas"></canvas>
                                            <span class="badge-text">Mythical</span>
                                        </span>
                                    </div>
                                </td>
                                <td>25,000 Gems</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <p class="mt-4">
                    When you Rebirth a Legendary fruit, you are guaranteed a new Mythical fruit that you don't already have. After Rebirth, your fruit level will reset to 1, allowing you to level it up to 300 again with no nerf to gems acquired per level.
                </p>
            </div>
        </div>
    </div>
</div>

<style>
/* New Loading Animation Styles */
.loading-animation-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #ffffff; /* Solid white background immediately */
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    /* Removed padding-bottom to center new loader */
    /* Transition applies mainly to fade-out now - Smoother easing and longer duration */
    transition: opacity 0.7s cubic-bezier(0.4, 0, 0.2, 1),
                transform 0.7s cubic-bezier(0.4, 0, 0.2, 1),
                filter 0.7s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Wrapper to arrange logo and loader */
.loading-content-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0; /* Start hidden */
    filter: blur(5px); /* Start blurred */
    /* Smoother easing and longer duration for fade-in */
    transition: opacity 0.7s cubic-bezier(0.4, 0, 0.2, 1),
                filter 0.7s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Fade in wrapper when container is visible */
.loading-animation-container.visible .loading-content-wrapper {
    opacity: 1;
    filter: blur(0px);
}

/* Style for the added logo */
.loading-logo-img {
    max-width: 95%; /* Made wider */
    max-height: 450px; /* Made much taller (approx 3x area increase) */
    margin-bottom: 60px; /* Increased space below logo */
}

/* Loader CSS */
.loader {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  position: relative;
  box-shadow: 0 0 30px 4px rgba(0, 0, 0, 0.5) inset,
      0 5px 12px rgba(0, 0, 0, 0.15);
  overflow: hidden;
  background-color: #ffe8d6; /* Added light orange background */
  /* Removed initial opacity/filter, handled by wrapper */
  /* Removed transition, handled by wrapper */
}

.loader:before,
.loader:after {
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 45%;
  top: -40%;
  background-color: #007bff; /* Changed to Blue */
  animation: wave 5s linear infinite;
}

.loader:before {
  border-radius: 30%;
  background: rgba(204, 85, 0, 0.6); /* Changed to Dark Orange with transparency */
  animation: wave 5s linear infinite;
  }

@keyframes wave {
  0% {
    transform: rotate(0);
  }

  100% {
    transform: rotate(360deg);
  }
}

/* Container fades out when hidden */
.loading-animation-container.hidden {
    opacity: 0;
    transform: scale(0.97);
    filter: blur(5px);
    pointer-events: none;
}

.fruits-page {
    position: relative;
    padding-top: 2rem;
}

.header-accent {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    background: linear-gradient(90deg, var(--bs-primary), var(--bs-purple));
    border-radius: 5px;
}

.section-header {
    text-align: center;
    margin-bottom: 2.5rem;
}

.section-subtitle {
    color: var(--bs-secondary);
    font-size: 1.1rem;
    margin-top: -0.5rem;
}

.icon-wrapper {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: rgba(var(--bs-primary-rgb), 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

/* Fruit Grid */
.fruit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
    min-height: 200px;
    position: relative;
}

.fruit-card-inner {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 10px;
    overflow: hidden;
}

.fruit-card-inner:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important;
}

.fruit-image-container {
    height: 180px;
    overflow: hidden;
    position: relative;
    border-radius: 10px 10px 0 0;
    box-shadow: inset 0 -10px 20px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(255,255,255,0.7) 0%, rgba(240,240,240,0.7) 100%);
    transform-style: preserve-3d;
    perspective: 800px;
}

.fruit-image-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 100%);
    z-index: 1;
    opacity: 0.7;
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    transform-style: preserve-3d;
}

.fruit-image-container::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at center, rgba(255,255,255,0) 50%, rgba(0,0,0,0.4) 150%);
    z-index: 2;
    opacity: 0;
    transition: opacity 0.4s ease-out;
}

.fruit-card-inner:hover .fruit-image-container::before {
    opacity: 0.6;
    transform: translateZ(10px);
}

.fruit-card-inner:hover .fruit-image-container::after {
    opacity: 0.4;
}

.fruit-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: all 0.5s cubic-bezier(0.33, 1, 0.68, 1);
    transform-origin: center;
    filter: brightness(0.95);
    position: relative;
    z-index: 0;
    background: rgba(10, 10, 10, 0.03);
    transform-style: preserve-3d;
}

.fruit-card-inner:hover .fruit-img {
    transform: scale(1.08);
    filter: brightness(1.05) contrast(1.05);
    animation: float-rotate 4s ease-in-out infinite;
}

/* 3D card effect with more dimension */
.fruit-card-inner {
    transition: all 0.3s cubic-bezier(0.33, 1, 0.68, 1);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),
                0 3px 6px rgba(0, 0, 0, 0.05);
    transform-style: preserve-3d;
    transform: perspective(1000px) rotateY(0deg) rotateX(0deg);
    will-change: transform, box-shadow;
}

.fruit-card-inner:hover {
    transform: perspective(1000px) translateY(-5px) translateZ(10px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15),
                0 8px 10px rgba(0, 0, 0, 0.05),
                0 0 20px rgba(var(--bs-primary-rgb), 0.1);
}

/* Additional ambient light effect */
.fruit-image-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 100%);
    z-index: 1;
    opacity: 0.7;
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    transform-style: preserve-3d;
}

.fruit-card-inner:hover .fruit-image-container::before {
    opacity: 0.6;
    transform: translateZ(10px);
}

/* Enhanced dynamic shadow effect */
.fruit-card-inner::after {
    content: '';
    position: absolute;
    bottom: 5px;
    left: 5%;
    width: 90%;
    height: 15px;
    background: rgba(0,0,0,0);
    filter: blur(15px);
    border-radius: 50%;
    z-index: -1;
    opacity: 0.3;
    transition: all 0.3s ease-out;
}

.fruit-card-inner:hover::after {
    opacity: 0.4;
    height: 10px;
    filter: blur(10px);
    bottom: 0px;
}

/* Custom Accordion */
.custom-accordion .accordion-item {
    border-radius: 10px;
    overflow: hidden;
}

.custom-accordion .accordion-button {
    padding: 1rem 1.25rem;
    font-weight: 600;
    border-radius: 10px;
}

.custom-accordion .accordion-button:not(.collapsed) {
    color: var(--bs-primary);
    background-color: rgba(var(--bs-primary-rgb), 0.05);
}

.category-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background-color: rgba(var(--bs-primary-rgb), 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
}

/* Pity badges */
.pity-list {
    list-style: none;
    padding-left: 0;
}

.pity-list li {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
}

.pity-tag {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 20px;
    margin-right: 15px;
    font-weight: 600;
    font-size: 0.9rem;
    min-width: 120px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.pity-tag-rare {
    background-color: #a8e4ff;
    color: #0085cc;
}

.pity-tag-epic {
    background-color: #e0c6ff;
    color: #7928ca;
}

.pity-tag-legendary {
    background-color: #ffe9a8;
    color: #cc8500;
}

/* Animation enhancements */
[data-aos] {
    transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
}

/* Rebirth System Card Styles - Matching the image */
.rebirth-system-card {
    border-radius: 8px;
    overflow: hidden;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.rebirth-header {
    background: #0075ff;
    color: white;
    padding: 14px 20px;
    font-weight: 500;
}

.rebirth-content {
    padding: 24px;
}

/* info-box class replaced with custom-alert */

.rebirth-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
}

.rebirth-table th {
    background-color: #f1f3f5;
    color: #333;
    font-weight: 600;
    text-align: left;
    padding: 12px 16px;
    border: 1px solid #dee2e6;
}

.rebirth-table td {
    padding: 12px 16px;
    border: 1px solid #dee2e6;
}

/* Add styles for badges in table */
.rebirth-table .badge-effect {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 100px;
    height: 30px;
    position: relative;
    border-radius: 4px;
    padding: 2px 10px;
    margin: 0 5px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transform: none;
}

.rebirth-table .badge-text {
    position: relative;
    z-index: 2;
    font-weight: 600;
    font-size: 14px;
    text-align: center;
}

/* Specific colors for each rarity */
.rebirth-table .badge-effect-common {
    background-color: #6c757d;
    color: white;
}

.rebirth-table .badge-effect-uncommon {
    background-color: #28a745;
    color: white;
}

.rebirth-table .badge-effect-rare {
    background-color: #007bff;
    color: white;
}

.rebirth-table .badge-effect-epic {
    background-color: #9933cc;
    color: white;
}

.rebirth-table .badge-effect-legendary {
    background-color: #ffc107;
    color: black;
}

.rebirth-table .badge-effect-mythical {
    background-color: #dc3545;
    color: white;
    box-shadow: 0 0 10px rgba(255, 0, 0, 0.4);
}

/* Canvas sizing for special effects */
.rebirth-table .legendary-shine-canvas,
.rebirth-table .mythical-lightning-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
}

/* Arrow styling */
.rebirth-table .progression-arrow {
    font-size: 18px;
    color: #495057;
}

/* Restore table row styling */
.rebirth-table tr:nth-child(even) {
    background-color: #f8f9fa;
}

.rebirth-table tr:hover {
    background-color: #e9ecef;
}

/* Filter Card Styles REMOVED */

/* Improved card animations */
.fruit-card {
    transition: transform 0.3s ease, opacity 0.3s ease;
}

/* Loading state REMOVED */

/* Fruit Container and Grid */
.fruit-container {
    margin-top: 2rem;
    min-height: 300px;
}

.fruit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
    position: relative;
}

/* Fruit Type Ribbon */
.fruit-type-ribbon {
    position: absolute;
    top: 15px; /* Adjust vertical position */
    right: -10px; /* Adjust horizontal position */
    width: 100px; /* Adjust width */
    padding: 4px 0;
    background-color: #6c757d; /* Default color (e.g., gray) */
    color: white;
    text-align: center;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
    transform: rotate(45deg) translateY(-50%);
    transform-origin: top right;
    z-index: 3; /* Ensure it's above the image */
    box-shadow: 0 2px 3px rgba(0,0,0,0.3);
    line-height: 1.2; /* Adjust line height for better centering */
}

.fruit-type-ribbon span {
    display: inline-block;
    padding: 0 5px; /* Add some horizontal padding inside span if needed */
}

/* Type specific colors */
.fruit-type-logia { background-color: #e67e22; } /* Orange for Logia */
.fruit-type-paramecia { background-color: #3498db; } /* Blue for Paramecia */
.fruit-type-zoan { background-color: #2ecc71; } /* Green for Zoan */

/* Adjust card if needed */
.fruit-card-inner {
    overflow: hidden; /* Ensure ribbon corners are clipped */
    position: relative; /* Needed for absolute positioning of ribbon */
}

/* No results message styles REMOVED */
/* Clear filters button styles REMOVED */

/* New Search Input Styles from Uiverse.io by roroland */
.label {
  --border: rgba(66, 66, 66, 0.733);
  --bgLabel: #f0f0f0; /* Adjusted background */
  --bgInput: rgba(255,255,255,1);
  --color-light: #ff5722; /* Use site primary color */
  --color-light-a: #757575; /* Adjusted placeholder color */
  display: grid;
  grid-template-rows: min-content min-content;
  background: var(--bgLabel);
  border-radius: 8px; /* Added border-radius */
  padding: 5px; /* Added padding */
  position: relative;
  font-size: .65rem;
  transition: all .3s ease-out;
  width: 100%; /* Changed from 80% */
}

.label > .label-title {
  border: 1px solid var(--color-light);
  color: var(--color-light);
  box-shadow: 0 2px 2px rgba(120,120,120,.25);
  padding: .25em .5em;
  background-color: var(--bgInput);
  grid-column: 1/span 1; /* Ensure title stays in first column conceptually */
  grid-row: 1/span 1;
  position: relative;
  border-radius: 4px;
  translate: 10px -10px;
  transition: all .5s ease-out .5s;
  z-index: 10;
  font-weight: bold;
  width: max-content; /* Fit width to content */
}

.label:focus-within .input {
  background-color: var(--bgInput);
  padding: 1em;
  color: var(--color-light);
  border: 2px solid var(--color-light);
  outline: 2px solid var(--color-light);
  outline-offset: -2px;
  border-radius: 12px;
  box-shadow: 0 5px 10px rgba(255, 87, 34, .25), 0 -5px 20px rgba(255, 87, 34,.1);
  scale: 1.1;
  transition: all .5s cubic-bezier(0,1.46,1,1.62) .3s;
}

.label:focus-within .label-title {
  translate: 10px -25px; /* Adjusted translate */
  border-radius: 4px 4px 0 0;
  z-index: 0;
  transition: all .3s cubic-bezier(0,1.46,1,1.62);
}

.input {
  appearance: none;
  border: 2px solid transparent;
  border-bottom: 2px solid var(--color-light);
  background-color: var(--bgInput);
  caret-color: var(--color-light);
  width: 100%; /* Ensure input takes full width of label */
  padding: 1.25em 1em .25em;
  outline: 0px solid var(--color-light);
  grid-column: 1/-1;
  grid-row: 1 / -1;
  position: relative;
  transition: all .3s cubic-bezier(.5,.6,.5,.62);
  z-index: 0;
  font-size: 1rem; /* Increased font size */
  border-radius: 8px; /* Match label radius */
}

.input,
.input::placeholder {
  color: var(--color-light-a);
}

/* End of New Search Input Styles */

.no-results {
    display: none; /* Hidden by default */
    padding: 40px 20px;
    text-align: center;
    background-color: #f8f9fa;
    border-radius: 8px;
    margin-top: 2rem;
    border: 1px dashed #dee2e6;
}

.no-results-content i {
    font-size: 2.5rem;
    color: #adb5bd;
    margin-bottom: 1rem;
}

.no-results-content p {
    font-size: 1.1rem;
    color: #495057;
    margin-bottom: 0;
}

/* Simplified Fruit Container */
.loading-fruits-simple {
    position: relative;
    margin-bottom: 35px; /* Increased space */
    height: 60px; /* Increased height */
}

.fruit {
    position: absolute;
    font-size: 55px; /* Further increased size */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
    animation: fruitPopSimple 1.5s ease-in-out infinite; /* Changed animation */
}

/* Removed other fruit delays */

.loading-text {
    margin-top: 0;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    font-size: 28px; /* Further increased size */
    color: #333;
    display: flex;
}

/* Removed Spinner Keyframes */

/* Simplified Fruit Pop Animation */
@keyframes fruitPopSimple {
    0%, 100% {
        opacity: 0.6;
        transform: translate(-50%, -50%) scale(0.8);
    }
    50% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
    }
}

@keyframes textPulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
}

/* Added Text Loader CSS */
.text-loader-card {
  /* Variable for clipping effect - Set to loading screen background */
  --bg-color: #ffffff;
  /* Removed background-color: var(--bg-color); - Not needed for transparent card */
  /* Removed padding: 1rem 2rem; - Not needed */
  /* Removed border-radius: 1.25rem; - Not needed */
  margin-top: 30px; /* Space above text loader */
}

/* Renamed from .loader to avoid conflict */
.text-loader {
  color: #6c757d; /* Keep grey for static text */
  font-family: "Poppins", sans-serif;
  font-weight: 500;
  font-size: 22px; /* Slightly smaller */
  -webkit-box-sizing: content-box;
  box-sizing: content-box;
  height: 35px; /* Adjust height */
  padding: 5px 10px; /* Adjust padding */
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  /* Removed border-radius: 8px; */
}

.text-loader p {
    margin-right: 0.5em; /* Space between loading and words */
}

.words {
  overflow: hidden;
  position: relative;
  height: 100%; /* Ensure height matches parent */
}

.words::after {
  content: "";
  position: absolute;
  inset: 0;
  /* Use the variable for clipping */
  background: linear-gradient(
    var(--bg-color) 5%, /* Adjust gradient for better clipping */
    transparent 25%,
    transparent 75%,
    var(--bg-color) 95%
  );
  z-index: 20;
}

.word {
  display: block;
  height: 100%;
  padding-left: 6px;
  color: #ff5722; /* Theme Orange for animated words */
  animation: spin_text_loader 4s infinite;
}

/* Renamed keyframes */
@keyframes spin_text_loader {
  10% {
    -webkit-transform: translateY(-102%);
    transform: translateY(-102%);
  }

  25% {
    -webkit-transform: translateY(-100%);
    transform: translateY(-100%);
  }

  35% {
    -webkit-transform: translateY(-202%);
    transform: translateY(-202%);
  }

  50% {
    -webkit-transform: translateY(-200%);
    transform: translateY(-200%);
  }

  60% {
    -webkit-transform: translateY(-302%);
    transform: translateY(-302%);
  }

  75% {
    -webkit-transform: translateY(-300%);
    transform: translateY(-300%);
  }

  85% {
    -webkit-transform: translateY(-402%);
    transform: translateY(-402%);
  }

  100% {
    -webkit-transform: translateY(-400%);
    transform: translateY(-400%);
  }
}

/* Container fades out when hidden */
.loading-animation-container.hidden {
    opacity: 0;
    transform: scale(0.97);
    filter: blur(5px);
    pointer-events: none;
}

/* 3D Idle Animation for Fruits */
@keyframes float-rotate {
    0% {
        transform: translateY(0) translateZ(0) rotateY(0deg) rotateX(0deg);
    }
    25% {
        transform: translateY(-5px) translateZ(10px) rotateY(3deg) rotateX(-2deg);
    }
    50% {
        transform: translateY(-2px) translateZ(15px) rotateY(5deg) rotateX(0deg);
    }
    75% {
        transform: translateY(-8px) translateZ(8px) rotateY(2deg) rotateX(3deg);
    }
    100% {
        transform: translateY(0) translateZ(0) rotateY(0deg) rotateX(0deg);
    }
}

.fruit-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: all 0.5s cubic-bezier(0.33, 1, 0.68, 1);
    transform-origin: center;
    filter: brightness(0.95);
    position: relative;
    z-index: 0;
    background: rgba(10, 10, 10, 0.03);
    transform-style: preserve-3d;
}

.fruit-card-inner:hover .fruit-img {
    transform: scale(1.08);
    filter: brightness(1.05) contrast(1.05);
    animation: float-rotate 4s ease-in-out infinite;
}

.fruit-image-container {
    height: 180px;
    overflow: hidden;
    position: relative;
    border-radius: 10px 10px 0 0;
    box-shadow: inset 0 -10px 20px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(255,255,255,0.7) 0%, rgba(240,240,240,0.7) 100%);
    transform-style: preserve-3d;
    perspective: 800px;
}

/* 3D card effect with more dimension */
.fruit-card-inner {
    transition: all 0.3s cubic-bezier(0.33, 1, 0.68, 1);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),
                0 3px 6px rgba(0, 0, 0, 0.05);
    transform-style: preserve-3d;
    transform: perspective(1000px) rotateY(0deg) rotateX(0deg);
    will-change: transform, box-shadow;
}

/* Additional ambient light effect */
.fruit-image-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 100%);
    z-index: 1;
    opacity: 0.7;
    transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    transform-style: preserve-3d;
}

.fruit-card-inner:hover .fruit-image-container::before {
    opacity: 0.6;
    transform: translateZ(10px);
}

/* Enhanced dynamic shadow effect */
.fruit-card-inner::after {
    content: '';
    position: absolute;
    bottom: 5px;
    left: 5%;
    width: 90%;
    height: 15px;
    background: rgba(0,0,0,0);
    filter: blur(15px);
    border-radius: 50%;
    z-index: -1;
    opacity: 0.3;
    transition: all 0.3s ease-out;
}

.fruit-card-inner:hover::after {
    opacity: 0.4;
    height: 10px;
    filter: blur(10px);
    bottom: 0px;
}
</style>

<!-- Mobile Optimization Styles -->
<style>
@media (max-width: 767px) {
    /* Improve fruit grid on mobile */
    .fruit-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 0.8rem;
    }

    /* Smaller fruit cards for mobile */
    .fruit-image-container {
        height: 120px;
    }

    /* More compact card body */
    .fruit-card-inner .card-body {
        padding: 0.75rem;
    }

    /* Smaller card title and text */
    .fruit-card-inner .card-title {
        font-size: 1rem;
        margin-bottom: 0.5rem;
    }

    .fruit-card-inner .card-text {
        font-size: 0.8rem;
    }

    /* Make rebirth table scroll horizontally */
    .rebirth-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }

    /* Adjust section spacing */
    .section-header {
        margin-bottom: 1.5rem;
    }

    /* Improve search input on mobile */
    .label > .label-title {
        translate: 5px -10px;
        font-size: 0.6rem;
    }

    .label:focus-within .input {
        scale: 1.05;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Loading Animation Logic
document.addEventListener('DOMContentLoaded', function() {
const loadingOverlay = document.getElementById('loading-overlay');
    const contentWrapper = loadingOverlay ? loadingOverlay.querySelector('.loading-content-wrapper') : null;

    if (loadingOverlay && contentWrapper) {
        // Slightly delay adding 'visible' class to container to trigger wrapper fade-in
        setTimeout(function() {
            loadingOverlay.classList.add('visible');
        }, 50); // 50ms delay

        // Hide loading animation after 1.5 seconds
        setTimeout(function() {
            loadingOverlay.classList.remove('visible');
        loadingOverlay.classList.add('hidden');

            // Remove from DOM after transition completes - Adjusted timeout duration
            setTimeout(function() {
                if (loadingOverlay.parentNode) {
                    loadingOverlay.remove();
                }
            }, 800); /* Match transition duration (700ms) + buffer */
        }, 1500); /* Updated duration to 1.5 seconds */
    }
});

// --- 3D Tilt Effect for Fruit Cards ---
document.addEventListener('DOMContentLoaded', function() {
    const fruitCards = document.querySelectorAll('.fruit-card-inner');

    fruitCards.forEach(card => {
        // Initialize variables to track if animation is active
        let isHovered = false;
        let tiltAnimation = null;

        // Add event listeners
        card.addEventListener('mouseenter', startTiltEffect);
        card.addEventListener('mousemove', tiltEffect);
        card.addEventListener('mouseleave', resetTilt);

        function startTiltEffect() {
            isHovered = true;
            // If there's an active animation, cancel it
            if (tiltAnimation) {
                card.style.animation = 'none';
                cancelAnimationFrame(tiltAnimation);
                tiltAnimation = null;
            }

            // Add specific class for when tilt effect is active
            card.classList.add('tilt-active');
            const fruitImg = card.querySelector('.fruit-img');
            if (fruitImg) {
                fruitImg.style.animation = 'none';
                fruitImg.classList.add('tilt-active');
            }
        }

        function tiltEffect(e) {
            if (!isHovered) return;

            // Get the dimensions and position of the card
            const rect = card.getBoundingClientRect();

            // Calculate the mouse position relative to the center of the card
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const mouseX = e.clientX;
            const mouseY = e.clientY;

            // Calculate how far from center the mouse is (in percentage)
            const percentX = (mouseX - centerX) / (rect.width / 2);
            const percentY = (mouseY - centerY) / (rect.height / 2);

            // Calculate the tilt angles (limit to 15 degrees max)
            const tiltX = -percentY * 15;
            const tiltY = percentX * 15;

            // Apply the tilt effect - more dramatic for the image
            card.style.transform = `perspective(1000px) rotateX(${tiltX}deg) rotateY(${tiltY}deg) scale3d(1.02, 1.02, 1.02)`;

            // Apply a more dramatic effect to the fruit image
            const fruitImg = card.querySelector('.fruit-img');
            if (fruitImg) {
                const imgTiltX = tiltX * 1.2; // More dramatic tilt
                const imgTiltY = tiltY * 1.2;
                const translateZ = 30 + Math.abs(percentX * percentY) * 30; // Dynamic depth
                fruitImg.style.transform = `rotateX(${imgTiltX}deg) rotateY(${imgTiltY}deg) translateZ(${translateZ}px) scale(1.1)`;
            }

            // Dynamic lighting effect based on tilt
            const imgContainer = card.querySelector('.fruit-image-container');
            if (imgContainer) {
                const lightingX = 50 + percentX * 40; // Light position X (10% - 90%)
                const lightingY = 50 + percentY * 40; // Light position Y (10% - 90%)
                imgContainer.style.background = `radial-gradient(circle at ${lightingX}% ${lightingY}%, rgba(255,255,255,0.8) 0%, rgba(240,240,240,0.5) 100%)`;
            }
        }

        function resetTilt() {
            isHovered = false;

            // Remove tilt-active class
            card.classList.remove('tilt-active');
            const fruitImg = card.querySelector('.fruit-img');
            if (fruitImg) {
                fruitImg.classList.remove('tilt-active');
            }

            // Smooth transition back
            card.style.transition = 'all 0.5s ease-out';
            card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)';

            // Reset the fruit image with animation
            if (fruitImg) {
                fruitImg.style.transition = 'all 0.5s ease-out';
                fruitImg.style.transform = 'rotateX(0deg) rotateY(0deg) translateZ(0px) scale(1)';

                // Restore the original animation after a brief delay
                setTimeout(() => {
                    fruitImg.style.transition = '';
                    fruitImg.style.animation = 'float-rotate 4s ease-in-out infinite';
                }, 500);
            }

            // Reset the background
            const imgContainer = card.querySelector('.fruit-image-container');
            if (imgContainer) {
                imgContainer.style.transition = 'background 0.5s ease-out';
                imgContainer.style.background = 'linear-gradient(135deg, rgba(255,255,255,0.7) 0%, rgba(240,240,240,0.7) 100%)';

                // Reset the transition property after the transition completes
                setTimeout(() => {
                    imgContainer.style.transition = '';
                }, 500);
            }

            // Reset the transition property after the transition completes
            setTimeout(() => {
                card.style.transition = '';
            }, 500);
        }
    });
});

// --- Search Functionality ---
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('fruit-search-input');
    const fruitListContainer = document.getElementById('fruit-list');
    const noResultsMessage = document.getElementById('no-search-results');
    const allFruitCards = fruitListContainer ? fruitListContainer.querySelectorAll('.fruit-card') : [];

    function handleSearch() {
        if (!searchInput || !allFruitCards.length || !noResultsMessage) return;

        const searchTerm = searchInput.value.toLowerCase().trim();
        let visibleCount = 0;

        allFruitCards.forEach(card => {
            const fruitName = card.getAttribute('data-fruit')?.toLowerCase() || '';
            const shouldShow = searchTerm === '' || fruitName.includes(searchTerm);

            if (shouldShow) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        noResultsMessage.style.display = (visibleCount === 0 && searchTerm !== '') ? 'block' : 'none';

        if (typeof AOS !== 'undefined') {
             AOS.refresh();
        }
    }

    // Debounce function (keep as is)
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // Add event listener only if search input exists
    if (searchInput) {
       searchInput.addEventListener('input', debounce(handleSearch, 250)); // Debounce for 250ms
       // Initial call in case the input has a value on page load (e.g., back button)
       handleSearch();
    }
});
</script>
{% endblock %}